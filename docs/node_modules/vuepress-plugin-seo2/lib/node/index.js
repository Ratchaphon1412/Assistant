"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@vuepress/utils"),t=require("vuepress-shared"),a=require("@vuepress/shared");const r=new t.Logger("vuepress-plugin-seo2"),n=({frontmatter:e},{hostname:a},{options:{base:r}})=>{const{banner:n,cover:o}=e;if(n){if(t.isAbsoluteUrl(n))return i(a,r,n);if(t.isUrl(n))return n}if(o){if(t.isAbsoluteUrl(o))return i(a,r,o);if(t.isUrl(o))return o}return null},o=({content:e},{hostname:a},{options:{base:r}})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(e);return n?n.map((([,e])=>t.isAbsoluteUrl(e)?i(a,r,e):t.isUrl(e)?e:null)).filter((e=>null!==e)):[]},i=(e,t,r)=>`${a.isLinkHttp(e)?a.removeEndingSlash(e):`https://${a.removeEndingSlash(e)}`}${t}${a.removeLeadingSlash(r)}`,s=(e,t,a="",n="")=>{t in e&&(r.error(`"${t}" is removed${n?`, please use ${n} instead.`:" and no longer supported"}${a?`\n${a}`:""}`),n||delete e[t])},l=(e,a,r)=>{const{isArticle:s=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=a,{options:{base:l},siteData:c}=r,{frontmatter:{author:g,time:p,date:u=p,tag:m,tags:d=m},data:{git:f={}}}=e,h=c.locales[e.pathLocale]?.title||c.title||c.locales["/"]?.title||"",$=!1===g?[]:t.getAuthor(g||a.author),{updatedTime:v}=f,b=v?new Date(v).toISOString():"",S=Array.isArray(d)?d:"string"==typeof m?[m]:[],w=e.title,y=n(e,a,r),D=o(e,a,r),x=((e,t)=>Object.entries(t).map((([,e])=>e.lang)).filter((t=>"string"==typeof t&&t!==e)))(e.lang,c.locales);let O="";if(u instanceof Date)O=new Date(u).toISOString();else if(u){const e=t.getDate(u);e&&e.value&&(O=e.value.toISOString())}const A=y||D[0]||a.fallBackImage||"";return{"og:url":i(a.hostname,l,e.path),"og:site_name":h,"og:title":w,"og:description":e.frontmatter.description||a.autoDescription&&e.frontmatter.summary||"","og:type":s(e)?"article":"website","og:image":A,"og:updated_time":b,"og:locale":e.lang,"og:locale:alternate":x,...a.restrictions?{"og:restrictions:age":a.restrictions}:{},...a.twitterID?{"twitter:creator":a.twitterID}:{},...A?{"twitter:card":"summary_large_image","twitter:image:alt":w}:{},"article:author":$[0]?.name,"article:tag":S,"article:published_time":O,"article:modified_time":b}},c=(e,{name:t,content:a,attribute:r=(["article:","og:"].some((e=>t.startsWith(e)))?"property":"name")})=>{a&&e.push(["meta",{[r]:t,content:a}])},g=(e,r,i)=>{const s=e.frontmatter.head||[],g=l(e,r,i),p=((e,a,r)=>{const{isArticle:i=(e=>Boolean(e.filePathRelative&&!e.frontmatter.home))}=a,{frontmatter:{author:s,time:l,date:c=l},data:{git:g={}}}=e,p=!1===s?[]:t.getAuthor(s||a.author),{updatedTime:u}=g,m=u?new Date(u).toISOString():"",d=e.title,f=n(e,a,r),h=o(e,a,r);let $="";if(c instanceof Date)$=new Date(c).toISOString();else if(c){const e=t.getDate(c);e&&e.value&&($=e.value.toISOString())}return i(e)?{"@context":"https://schema.org","@type":"NewsArticle",headline:d,image:h.length?h:[f||a.fallBackImage||""],datePublished:$,dateModified:m,author:p.map((e=>({"@type":"Person",...e})))}:null})(e,r,i),u=r.ogp?r.ogp(g,e,i):g,m=r.jsonLd?r.jsonLd(p,e,i):null,d=((e,t)=>"function"==typeof t.canonical?t.canonical(e):"string"==typeof t.canonical?`${a.removeEndingSlash(t.canonical)}${e.path}`:null)(e,r);((e,t)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach((t=>c(e,{name:"article:tag",content:t})));break;case"og:locale:alternate":t["og:locale:alternate"].forEach((a=>{a!==t["og:locale"]&&c(e,{name:"og:locale:alternate",content:a})}));break;default:t[a]&&c(e,{name:a,content:t[a]})}})(s,u),((e,t)=>{t&&e.push(["script",{type:"application/ld+json"},JSON.stringify(t)])})(s,m),((e,t)=>{t&&e.push(["link",{rel:"canonical",href:t}])})(s,d),r.customHead&&r.customHead(s,e,i),e.frontmatter.head=s},p=(a,n=!1)=>o=>{n&&(e=>{s(e,"seo","","ogp"),s(e,"customMeta","","customHead")})(a),o.env.isDebug&&r.info(`Options: ${a.toString()}`);const i={name:"vuepress-plugin-seo2"};return a.hostname?{...i,extendsPage:(e,r)=>{var n;e.frontmatter.description||(e.frontmatter.summary=t.stripTags(e.excerpt)||(n=e.content,n?((e="")=>e.replace(/<\/?.+?\/?>/g,""))(n).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split("\n").map((e=>e.trim())).join("\n").replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"").slice(0,180)||""),g(e,a,r)},onGenerated:t=>(async t=>{r.load("Generating robots.txt");const a=t.public("robots.txt");let n=e.fs.existsSync(a)?await e.fs.readFile(a,{encoding:"utf8"}):"";n&&!n.includes("User-agent")?(r.error(),r.update("robots.txt seems invalid!")):(n+="\nUser-agent:*\nDisallow:\n",await e.fs.writeFile(t.dest("robots.txt"),n,{flag:"w"}),r.succeed())})(t.dir)}:(r.error(`Option ${e.chalk.magenta("hostname")} is required!`),i)};exports.default=p,exports.seoPlugin=p;
//# sourceMappingURL=index.js.map
